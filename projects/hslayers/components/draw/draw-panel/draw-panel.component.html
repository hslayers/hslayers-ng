@let sidebarPosition = hsLayoutService.sidebarPosition | async;

<div class="d-flex flex-column">
  <div class="d-flex m-auto py-2 justify-content-around" style="white-space: nowrap;">
    <button type="button" class="btn rounded btn-primary hs-toolbar-button" (click)="HsDrawService.saveDrawingLayer()"
      [ngClass]="{'btn-sm' : sidebarPosition !== 'bottom'}">
      {{'COMMON.newDrawingLayer' | translate }}
    </button>
    <button type="button" (click)="HsDrawService.setType(HsDrawService.type)"
      [ngClass]="{'btn-sm' : sidebarPosition !== 'bottom'}" class="btn ms-1 rounded btn-primary hs-toolbar-button"
      [disabled]="!HsDrawService.type">
      {{'DRAW.disableDrawing' | translate }}
    </button>
  </div>
  <div class="btn-group w-100  m-auto justify-content-center"
    [ngClass]="sidebarPosition === 'bottom' ? 'btn-group-lg' : 'btn-group-sm'">
    @if (HsDrawService.drawableLayersAvailable || HsDrawService.tmpDrawLayer) {
    <div class="flex-row w-100 m-auto justify-content-center align-items-center text-primary py-3 py-md-0"
      style="display: flex;">
      <p class="m-0 p-0">{{'DRAW.drawingTo' | translate }}</p>
      <div ngbDropdown style="max-width: 50%;" placement="bottom">
        <button type="button" class="btn btn-sm rounded-0 hs-toolbar-button d-flex align-items-center mw-100"
          ngbDropdownToggle (click)="HsDrawService.fillDrawableLayers()"
          [ngClass]="{'btn-light btn-outline-danger border-0' : HsDrawService.tmpDrawLayer,'dropdown-toggle' : HsDrawService.drawableLayersAvailable }"
          [disabled]="!HsDrawService.drawableLayersAvailable">
          <div class="text-truncate">{{HsDrawService.selectedLayerString()}}</div>
        </button>
        <div ngbDropdownMenu style="max-width: 15em;">
          @if (HsDrawService.drawableLayers.length > 0) {
          <div class="d-flex align-items-center w-100 flex-column">
            <label class=" bg-primary w-100 text-light m-0 p-1">{{'DRAW.activeLayers' |
              translate }}</label>
            @for (layer of HsDrawService.drawableLayers; track layer) {
            <a class="dropdown-item text-truncate" data-toggle="tooltip"
              [title]="'LAYERS.' + getTitle(layer) | translate : {fallbackValue: getTitle(layer)} " (click)="selectLayer(layer)">{{getTitle(layer) |
              translate }}</a>
            }<!-- TODO: Remove function call from template -->
          </div>
          }
          @if (HsDrawService.drawableLaymanLayers.length > 0) {
          <div class="d-flex align-items-center w-100 flex-column">
            <div class=" bg-primary w-100 text-light m-0 p-1">
              <div class="d-flex justify-content-between">
                {{'DRAW.serverLayers' | translate }}
                <span (click)="onlyMineFilterVisible = !onlyMineFilterVisible" style="cursor: pointer;">
                  <i class="fa-solid fa-gears"></i>
                </span>
              </div>
              @if (onlyMineFilterVisible) {
              <div class="p-0 input-group-text border-0 justify-content-center bg-white">
                <label class="m-0">
                  <input type="checkbox" name="onlyMine" [(ngModel)]="HsDrawService.onlyMine"
                    (ngModelChange)="HsDrawService.fillDrawableLayers(); onlyMineFilterVisible = !onlyMineFilterVisible">
                  {{'COMPOSITIONS.onlyMine' | translate }}
                </label>
              </div>
              }
            </div>
            @for (layer of HsDrawService.drawableLaymanLayers; track layer) {
            <a class="dropdown-item text-truncate" data-toggle="tooltip" [title]="'LAYERS.' + layer.title | translate : {fallbackValue: layer.title} "
              (click)="selectLayer(layer)">{{'LAYERS.' + layer.title | translate : {fallbackValue: layer.title} }}</a>
            }
          </div>
          }
        </div>
      </div>
      @if (HsDrawService.tmpDrawLayer) {
      <button type="button" class="btn btn-light btn-outline-primary border-0 btn-sm"
        (click)="HsDrawService.saveDrawingLayer()" [title]="'DRAW.saveDrawingToLayer' | translate ">
        <i class="fa-solid fa-save"></i>
      </button>
      }
      @if (HsDrawService.hasSomeDrawables) {
      @if (HsDrawService.moreThanOneDrawable === true) {
      <div ngbDropdown placement="bottom-right" display="dynamic" style="white-space: nowrap;"
        #removeLayersDropdown="ngbDropdown">
        <button type="button" ngbDropdownToggle class="btn btn-light  btn-outline-danger btn-sm"
          [disabled]="!HsDrawService.drawableLayersAvailable" style="border: none !important;">
          <i class="fa-solid fa-trash"></i>
        </button>
        <div ngbDropdownMenu class="flex-column px-1 py-2">
          <div class="d-flex align-items-center w-100 flex-column">
            @if (HsDrawService.selectedLayer) {
            <a class="dropdown-item"
              (click)="HsDrawService.removeLayer(); removeLayersDropdown.close()">{{'COMMON.removeLayer'
              |
              translate }}</a>
            }
            <a class="dropdown-item"
              (click)="HsDrawService.removeMultipleLayers(); removeLayersDropdown.close()">{{'DRAW.removeMultipleLayers'
              | translate }}</a>
          </div>
        </div>
      </div>
      } @else {
      <button type="button" class="btn btn-light  btn-outline-danger btn-sm" (click)="HsDrawService.removeLayer()"
        [title]="'COMMON.removeLayer' | translate " style="border: none !important;">
        <i class="fa-solid fa-trash"></i>
      </button>
      }
      }
    </div>
    } @else {
    <p class="m-0 text-danger">{{'DRAW.noSuitableLayer' | translate }}</p>
    }
  </div>
</div>


<div class="rounded-0 my-1 draw-buttons d-flex justify-content-center"
  [ngClass]="sidebarPosition === 'bottom' ? 'btn-group-lg' : 'btn-group-sm'">
  @for (tool of drawTools; track tool.type) {
  <button class="btn btn-light btn-outline-primary" [ngClass]="{active: HsDrawService.type === tool.type}"
    (click)="setType(tool.type)" data-toggle="tooltip" [title]="tool.title | translate">
    <i [class]="tool.icon"></i>
  </button>
  }
  <div ngbDropdown placement="bottom-right" class="btn-group btn-group-sm" role="group"
    #selectionTypeDropdown="ngbDropdown">
    <button ngbDropdownToggle type="button" [ngClass]="{active: !HsDrawService.type }"
      [title]="'STYLER.selection' | translate " class="btn btn-light btn-outline-primary">
      <i class="fa-solid fa-cursor"></i>
    </button>
    <div ngbDropdownMenu style="white-space: nowrap;">
      <div class="d-flex gap-2 flex-column px-1 py-2">
        <div class="d-flex flex-row justify-content-around align-items-baseline">
          <label class="ms-1 cursor-pointer" for="draw-boxSelection">{{'DRAW.boxSelection' |
            translate }}</label>
          <input type="checkbox" [(ngModel)]="HsDrawService.boxSelectionActive"
            (change)="HsDrawService.toggleBoxSelection();selectionTypeDropdown.close()" id="draw-boxSelection"
            name="filterByExtent" class="cursor-pointer">
        </div>
        <button class="btn btn-primary btn-sm hs-draw-selectAll" [disabled]="!HsDrawService.selectedLayer"
          (click)="HsDrawService.selectAllFeatures();selectionTypeDropdown.close()" data-toggle="tooltip"
          [title]="'DRAW.deselectAllFeatures' | translate ">
          {{translateString('DRAW',HsDrawService.toggleSelectionString)}}
          <!-- TODO: Remove function call from template -->
        </button>
      </div>
    </div>
  </div>
</div>
<div class="pt-2">
  <div style="font-size: 0.9rem;">
    <div class="pb-2">
      <div class="form-check">
        <input class="d-none" type="checkbox" id="hs-draw-snap" [(ngModel)]="HsDrawService.snapActive"
          (change)="HsDrawService.toggleSnapping()" />
        <label for="hs-draw-snap"
          [ngClass]="{'hs-checkmark':HsDrawService.snapActive,'hs-uncheckmark':!HsDrawService.snapActive}">{{'DRAW.allowSnapping'
          | translate }}</label>
      </div>
      @if (HsDrawService.snapActive && HsDrawService.drawableLayers.length > 1 && !inToolbar()) {
      <div class="d-flex align-items-center card flex-row justify-content-around mx-3 text-primary">
        <p class="m-0 p-0">{{'DRAW.snapTo' | translate }}:</p>
        <div ngbDropdown placement="bottom" class="w-50 d-flex justify-content-center">
          <button ngbDropdownToggle type="button"
            class="btn btn-sm rounded-0 hs-toolbar-button d-flex align-items-center mw-100"
            (click)=" HsDrawService.fillDrawableLayers() " style=" font-size: small;">
            <div class="mw-100 text-truncate">{{HsDrawService.snapLayerString()}}</div>
          </button>
          <div ngbDropdownMenu style="max-width: 150%;">
            <div class="d-flex align-items-center w-100 flex-column">
              @for (layer of HsDrawService.drawableLayers; track layer) {
              <a class="dropdown-item text-truncate" data-toggle="tooltip"
                [title]="'LAYERS.' + getTitle(layer) | translate : {fallbackValue: getTitle(layer)} " (click)="changeSnapSource(layer)">{{'LAYERS.' + getTitle(layer)
                | translate : {fallbackValue: getTitle(layer)} }}</a>
              }<!-- TODO: Remove function call from template -->
            </div>
          </div>
        </div>
      </div>
      }
    </div>
  </div>
</div>
