@if ({ position: hsLayoutService.sidebarPosition | async }; as sidebar) {
<div class="btn-group" [hidden]="(isVisible$ | async) === false">
  <button class="btn btn-light hs-toolbar-button text-secondary"
    [ngClass]="{ 'btn-outline-danger': HsDrawService.highlightDrawButton }" (click)="toggleDrawToolbar()">
    <i [ngClass]="{
          'icon-pencil': !drawToolbarExpanded,
          'icon-remove': drawToolbarExpanded,
        }" data-toggle="tooltip" [title]="'PANEL_HEADER.draw' | translateHs"></i>
  </button>
  @if (drawToolbarExpanded) {
  <div class="btn-group">
    <div class="btn-group" ngbDropdown placement="bottom-left" display="dynamic">
      <button type="button" ngbDropdownToggle
        class="btn btn-light rounded-0 btn-secondary dropdown-toggle hs-draw-layer-toggle d-flex align-items-center"
        [hidden]="
              !(
                HsDrawService.drawableLayersAvailable ||
                HsDrawService.tmpDrawLayer
              )
            " (click)="
              controlLayerListAction(); HsDrawService.fillDrawableLayers()
            " style="
              max-width: 125px;
              overflow: hidden;
              font-size: 0.9rem;
              z-index: 2;
            " [ngClass]="
              HsDrawService.tmpDrawLayer
                ? 'btn-outline-danger'
                : 'btn-outline-primary'
            ">
        <div class="text-truncate pe-1">
          {{ HsDrawService.selectedLayerString() }}
        </div>
      </button>
      <div ngbDropdownMenu class="dropdown-menu" style="max-width: 20em">
        @if (HsDrawService.drawableLayers.length > 0) {
        <div class="d-flex align-items-center w-100 flex-column">
          <label class="bg-primary w-100 text-light m-0 p-1">{{
            "DRAW.activeLayers" | translateHs
            }}</label>
          @for (layer of HsDrawService.drawableLayers; track layer) {
          <a class="dropdown-item text-truncate" (click)="selectLayer(layer)">{{ getTitle(layer) | translateHs: "LAYERS"
            }}</a>
          }
        </div>
        }
        @if (HsDrawService.hasSomeDrawables) {
        <div class="d-flex align-items-center w-100 flex-column">
          <div class="bg-primary w-100 text-light m-0 p-1">
            <div class="d-flex justify-content-between">
              {{ "DRAW.serverLayers" | translateHs }}
              <span (click)="onlyMineFilterVisible = !onlyMineFilterVisible" style="cursor: pointer">
                <i class="icon-settingsthree-gears"></i>
              </span>
            </div>
            @if (onlyMineFilterVisible) {
            <div class="p-0 input-group-text border-0 justify-content-center bg-white">
              <label class="m-0">
                <input type="checkbox" name="onlyMine" [(ngModel)]="HsDrawService.onlyMine" (ngModelChange)="
                            HsDrawService.fillDrawableLayers();
                            onlyMineFilterVisible = !onlyMineFilterVisible
                          " />
                {{ "COMPOSITIONS.onlyMine" | translateHs }}
              </label>
            </div>
            }
          </div>
          @for (
          layer of HsDrawService.drawableLaymanLayers;
          track layer
          ) {
          <a class="dropdown-item text-truncate" (click)="selectLayer(layer)">{{ layer.title | translateHs: "LAYERS"
            }}</a>
          }
        </div>
        }
      </div>
    </div>
    <button class="btn btn-light hs-toolbar-button btn-outline-secondary" [hidden]="HsDrawService.tmpDrawLayer"
      (click)="HsDrawService.saveDrawingLayer()" data-toggle="tooltip"
      [title]="'DRAW.drawToolbar.addDrawLayer' | translateHs">
      <i class="icon-plus"></i>
    </button>
    @if (HsDrawService.tmpDrawLayer) {
    <button type="button" class="btn btn-light hs-toolbar-button btn-outline-secondary"
      (click)="HsDrawService.saveDrawingLayer()" [title]="'DRAW.saveDrawingToLayer' | translateHs">
      <i class="glyphicon icon-save-floppy"></i>
    </button>
    }
    @if (HsDrawService.drawableLayers.length > 0) {
    @if (HsDrawService.moreThanOneDrawable === true) {
    <div class="btn-group">
      <div ngbDropdown placement="bottom-right" display="dynamic" style="white-space: nowrap"
        #removeLayersDropdown="ngbDropdown">
        <button type="button" ngbDropdownToggle class="btn btn-light hs-toolbar-button rounded-0 btn-outline-secondary">
          <i class="glyphicon icon-trash"></i>
        </button>
        <div ngbDropdownMenu class="flex-column px-1 py-2">
          <div class="d-flex align-items-center w-100 flex-column">
            @if (HsDrawService.selectedLayer) {
            <a class="dropdown-item" (click)="
                          HsDrawService.removeLayer();
                          removeLayersDropdown.close()
                        ">{{ "COMMON.removeLayer" | translateHs }}</a>
            }
            <a class="dropdown-item" (click)="
                        HsDrawService.removeMultipleLayers();
                        removeLayersDropdown.close()
                      ">{{ "DRAW.removeMultipleLayers" | translateHs }}</a>
          </div>
        </div>
      </div>
    </div>
    } @else {
    <button type="button" class="btn btn-light hs-toolbar-button rounded-0 btn-outline-secondary"
      (click)="HsDrawService.removeLayer()" [title]="'COMMON.removeLayer' | translateHs">
      <i class="glyphicon icon-trash"></i>
    </button>
    }
    }
    <div class="btn-group">
      <div ngbDropdown placement="bottom-right" display="dynamic" style="white-space: nowrap"
        #selectionTypeDropdown="ngbDropdown">
        <button type="button" ngbDropdownToggle [ngClass]="{ active: !HsDrawService.type }"
          [title]="'STYLER.selection' | translateHs"
          class="btn btn-light hs-toolbar-button btn-outline-secondary rounded-0"
          (click)="$event.preventDefault(); selectionMenuToggled()">
          <i class="icon-cursor"></i>
        </button>
        <div ngbDropdownMenu class="flex-column px-1 py-2">
          <div class="d-flex flex-row justify-content-around align-items-baseline">
            <label class="ms-1 cursor-pointer" for="draw-boxSelection">
              {{ "DRAW.boxSelection" | translateHs }}</label>
            <input type="checkbox" [(ngModel)]="HsDrawService.boxSelectionActive" (change)="
                    HsDrawService.toggleBoxSelection();
                    selectionTypeDropdown.close()
                  " id="draw-boxSelection" name="filterByExtent" class="cursor-pointer" />
          </div>
          <button class="btn btn-primary btn-sm hs-draw-selectAll w-100" [disabled]="!HsDrawService.selectedLayer"
            (click)="
                  HsDrawService.selectAllFeatures();
                  selectionTypeDropdown.close()
                " data-toggle="tooltip" [title]="'STYLER.selection' | translateHs">
            {{ HsDrawService.toggleSelectionString | translateHs: "DRAW" }}
          </button>
        </div>
      </div>
    </div>
    @if (drawToolbarExpanded) {
    <div class="btn-group" ngbDropdown placement="bottom" display="dynamic" #geometryTypeDropdown="ngbDropdown">
      <div style="top: 35vh" role="group" class="btn-group-vertical position-fixed d-flex flex-column" [ngStyle]="
                sidebar.position === 'right' || sidebar.position === 'bottom'
                  ? { left: 0 }
                  : { right: 0 }
              ">
        @if (HsDrawService.drawActive) {
        <button class="btn btn-secondary" (click)="HsDrawService.removeLastPoint()" data-toggle="tooltip"
          [title]="'DRAW.drawToolbar.removeLastPoint' | translateHs">
          <i class="icon-remove-circle"></i>
        </button>
        }
        @if (HsDrawService.drawActive) {
        <button class="btn btn-secondary" (click)="finishDrawing()" data-toggle="tooltip"
          [title]="'DRAW.drawToolbar.finishFeature' | translateHs">
          <i class="icon-check"></i>
        </button>
        }
      </div>
      <button ngbDropdownToggle type="button" data-test="Geometry menu" style="line-height: 1 !important"
        [ngClass]="{ active: HsDrawService.type }" class="btn btn-light rounded-0 btn-outline-secondary"
        aria-haspopup="true">
        @if (!HsDrawService.type) {
        <label class="m-0">{{
          "DRAW.drawToolbar.selectType" | translateHs
          }}</label>
        }
        <i [ngClass]="{
                  'icon-pin': HsDrawService.type === 'Point',
                  'icon-polygonlasso': HsDrawService.type === 'Polygon',
                  'icon-line': HsDrawService.type === 'LineString',
                }"></i>
      </button>
      <div ngbDropdownMenu class="p-0" style="min-width: unset">
        <div class="btn-group">
          <button class="btn btn-light hs-toolbar-button btn-outline-secondary"
            [ngClass]="{ active: HsDrawService.type === 'Point' }"
            (click)="setType('Point'); geometryTypeDropdown.close()" data-toggle="tooltip"
            [title]="'COMMON.point' | translateHs">
            <i class="icon-pin"></i>
          </button>
          <button class="btn btn-light hs-toolbar-button btn-outline-secondary"
            [ngClass]="{ active: HsDrawService.type === 'Polygon' }"
            (click)="setType('Polygon'); geometryTypeDropdown.close()" data-toggle="tooltip"
            [title]="'COMMON.polygon' | translateHs">
            <i class="icon-polygonlasso"></i>
          </button>
          <button class="btn btn-light hs-toolbar-button btn-outline-secondary"
            [ngClass]="{ active: HsDrawService.type === 'LineString' }"
            (click)="setType('LineString'); geometryTypeDropdown.close()" data-toggle="tooltip"
            [title]="'COMMON.line' | translateHs">
            <i class="icon-line"></i>
          </button>
        </div>
      </div>
    </div>
    }
  </div>
  }
</div>
}
