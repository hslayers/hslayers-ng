<!-- Layer item template -->
<ng-template #layerItem let-layer="layer">
  <div class="hs-lm-item-title d-flex align-items-center" style="word-break:break-all; cursor:move">
    <button type="button" class="btn btn-sm hs-lm-item-visibility m-0 p-0"
      (click)="changeLayerVisibility(layer);$event.stopPropagation()"
    [ngClass]="layer.visible ? 'hs-checkmark' : 'hs-uncheckmark'"></button>
    <p class="m-0 ps-1">{{'LAYERS.' + layer.title | translate : {fallbackValue: layer.title} }}</p>
  </div>
</ng-template>
<!-- List placeholder template -->
<ng-template #listPlaceholder>
  <div class="p-2" style="border: 1px solid #ddd; text-align: center; color: rgba(0,0,0,0.3);">
    {{'MAP_SWIPE.noLayers' | translate }}
  </div>
</ng-template>

@if (isVisible$ | async) {
  <div class="card hs-main-panel" [ngClass]="panelWidthClass">
    <hs-panel-header name="mapSwipe" [panelTabs]="'MAP_SWIPE'">
    </hs-panel-header>
    <div class="card-body m-2">
      <div class="alert alert-info ps-2 text-center" role="alert">
        {{'MAP_SWIPE.dndLayers' | translate }}
      </div>
      <div class="d-flex justify-content-between gap-2 mb-2">
        <div class="btn-group align-items-center d-flex flex-grow-1" data-toggle="buttons">
          @for (swipeOption of swipeOptions; track swipeOption) {
            <button class="btn btn-sm  text-truncate h-100" type="button"
              (click)="setOrientation()" [disabled]="!hsMapSwipeService.swipeControlActive"
              [ngClass]="hsMapSwipeService.orientation === swipeOption ? 'btn-primary' : 'btn-secondary'">
              {{'MAP_SWIPE.' + swipeOption | translate }}
            </button>
          }
        </div>
        <div class="btn-group">
          <button class="btn btn-sm btn-secondary hs-map-swipe-reset" type="button" (click)="resetSwipePos()"
            style="max-width: 15ch;" [title]="'MAP_SWIPE.resetSlider' | translate"
            [disabled]="!hsMapSwipeService.swipeControlActive">
            <i class="fa-solid fa-rotate-right"></i>
          </button>
          <button class="btn btn-sm" type="button" (click)="setControl()"
            [ngClass]="hsMapSwipeService.swipeControlActive ? 'active btn-danger' : 'btn-primary'">
            {{getEnabledButtonString() | translate }}
          </button>
        </div>
      </div>
      @if (layersAvailable() && hsMapSwipeService.swipeControlActive) {
        <div class="pt-1">
          <table class="table table-sm table-striped table-borderless p-1" style="table-layout: fixed;">
            <tbody>
              <tr style="text-align: center;">
                <th colspan="2">{{'MAP_SWIPE.entireMap' | translate }}</th>
              </tr>
              <tr class="mb-1">
                <td colspan="2" cdkDropList #entireMapList="cdkDropList" (cdkDropListExited)="placeholders.entire = true"
                  (cdkDropListEntered)="placeholders.entire = false" [cdkDropListConnectedTo]="[leftList, rightList]"
                  [cdkDropListData]="hsMapSwipeService.entireMapLayers" (cdkDropListDropped)="drop($event, swipeSide.Full)">
                  @for (layer of hsMapSwipeService.entireMapLayers; track layer) {
                    <div class="list-group-item p-2" [ngClass]="{'activeLayer': layer.active}"
                      cdkDrag>
                      <ng-container *ngTemplateOutlet="layerItem;context:{layer: layer}"></ng-container>
                    </div>
                  }
                  @if (hsMapSwipeService.entireMapLayers?.length === 0 && placeholders.entire) {
                    <div>
                      <ng-container *ngTemplateOutlet="listPlaceholder"></ng-container>
                    </div>
                  }
                </td>
              </tr>
              <tr style="text-align: center;">
                @if (hsMapSwipeService.orientation === 'vertical') {
                  <th>{{'MAP_SWIPE.leftSide' | translate }}</th>
                  <th>{{'MAP_SWIPE.rightSide' | translate }}</th>
                } @else {
                  <th>{{'MAP_SWIPE.top' | translate }}</th>
                  <th>{{'MAP_SWIPE.bottom' | translate }}</th>
                }
              </tr>
              <tr>
                <td cdkDropList #leftList="cdkDropList" [cdkDropListConnectedTo]="[rightList, entireMapList]"
                  [cdkDropListData]="hsMapSwipeService.leftLayers" (cdkDropListDropped)="drop($event, swipeSide.Left)"
                  (cdkDropListExited)="placeholders.left = true" (cdkDropListEntered)="placeholders.left = false">
                  @for (layer of hsMapSwipeService.leftLayers; track layer) {
                    <div class="list-group-item p-2" [ngClass]="{'activeLayer': layer.active}"
                      cdkDrag>
                      <ng-container *ngTemplateOutlet="layerItem;context:{layer: layer}"></ng-container>
                    </div>
                  }
                  @if (hsMapSwipeService.leftLayers?.length === 0 && placeholders.left) {
                    <div>
                      <ng-container *ngTemplateOutlet="listPlaceholder"></ng-container>
                    </div>
                  }
                </td>
                <td cdkDropList #rightList="cdkDropList" [cdkDropListConnectedTo]="[leftList, entireMapList]"
                  [cdkDropListData]="hsMapSwipeService.rightLayers" (cdkDropListDropped)="drop($event, swipeSide.Right)"
                  (cdkDropListExited)="placeholders.right = true" (cdkDropListEntered)="placeholders.right = false">
                  @for (layer of hsMapSwipeService.rightLayers; track layer) {
                    <div class="list-group-item p-2" [ngClass]="{'activeLayer': layer.active}"
                      cdkDrag>
                      <ng-container *ngTemplateOutlet="layerItem;context:{layer: layer}"></ng-container>
                    </div>
                  }
                  @if (hsMapSwipeService.rightLayers?.length === 0 && placeholders.right) {
                    <div>
                      <ng-container *ngTemplateOutlet="listPlaceholder"></ng-container>
                    </div>
                  }
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      }
    </div>
  </div>
}
