<!-- Layer item template -->
<ng-template #layerItem let-layer="layer">
  <div class="hs-lm-item-title d-flex align-items-center" style="word-break:break-all; cursor:move">
    <button type="button" class="btn btn-sm hs-lm-item-visibility m-0 p-0"
      (click)="changeLayerVisibility(layer);$event.stopPropagation()"
      [ngClass]="layer.visible ? 'hs-checkmark' : 'hs-uncheckmark'"></button>
    <p class="m-0 ps-1">{{hsLayerUtilsService.translateTitle(layer.title)}}</p>
  </div>
</ng-template>
<!-- List placeholder template -->
<ng-template #listPlaceholder>
  <div class="p-2" style="border: 1px solid #ddd; text-align: center; color: rgba(0,0,0,0.3);">
    {{'MAP_SWIPE.noLayers' | translateHs : data}}
  </div>
</ng-template>

<div class="card hs-main-panel" [hidden]="!isVisible()">
  <hs-panel-header name="mapSwipe" [title]="'PANEL_HEADER.MAP_SWIPE' | translateHs : data" [app]="data.app"></hs-panel-header>
  <div class="card-body m-2">
    <div class="alert alert-info ps-2" role="alert">
      {{'MAP_SWIPE.dndLayers' | translateHs : data}}
    </div>
    <div class="btn-group align-items-center d-flex justify-content-between" style="margin-bottom: 1rem;"
      data-toggle="buttons">
      <button class="btn btn-sm btn-secondary text-truncate" style="max-width: 30%;" type="button"
        (click)="setOrientation()" [disabled]="!getSwipeControlActive()">
        {{getOrientationButtonString() | translateHs : data}}
      </button>
      <button class="btn btn-sm btn-secondary" type="button" (click)="resetSwipePos()"
        [disabled]="!getSwipeControlActive()">
        {{'MAP_SWIPE.resetSlider' | translateHs : data}}
      </button>
      <button class="btn btn-sm btn-primary" type="button" (click)="setControl()"
        [ngClass]="getSwipeControlActive() ? 'active' : ''">
        {{getEnabledButtonString() | translateHs : data}}
      </button>
    </div>
    <div *ngIf="layersAvailable() && getSwipeControlActive()" class="pt-1">
      <table class="table table-sm table-striped table-borderless p-1" style="table-layout: fixed;">
        <tbody>
          <tr style="text-align: center;">
            <th colspan="2">{{'MAP_SWIPE.entireMap' | translateHs : data}}</th>
          </tr>
          <tr class="mb-1">
            <td colspan="2" cdkDropList #entireMapList="cdkDropList" (cdkDropListExited)="placeholders.entire = true"
              (cdkDropListEntered)="placeholders.entire = false" [cdkDropListConnectedTo]="[leftList, rightList]"
              [cdkDropListData]="getEntireMapLayers()" (cdkDropListDropped)="drop($event, swipeSide.Full)">
              <div class="list-group-item p-2" [ngClass]="{'activeLayer': layer.active}"
                *ngFor="let layer of getEntireMapLayers()" cdkDrag>
                <ng-container *ngTemplateOutlet="layerItem;context:{layer: layer}"></ng-container>
              </div>
              <div *ngIf="getEntireMapLayers()?.length === 0 && placeholders.entire">
                <ng-container *ngTemplateOutlet="listPlaceholder"></ng-container>
              </div>
            </td>
          </tr>
          <tr style="text-align: center;">
            <ng-container *ngIf="getOrientation() === 'vertical'; else topDownLabels">
              <th>{{'MAP_SWIPE.leftSide' | translateHs : data}}</th>
              <th>{{'MAP_SWIPE.rightSide' | translateHs : data}}</th>
            </ng-container>
            <ng-template #topDownLabels>
              <th>{{'MAP_SWIPE.top' | translateHs : data}}</th>
              <th>{{'MAP_SWIPE.bottom' | translateHs : data}}</th>
            </ng-template>
          </tr>
          <tr>
            <td cdkDropList #leftList="cdkDropList" [cdkDropListConnectedTo]="[rightList, entireMapList]"
              [cdkDropListData]="getLeftLayers()" (cdkDropListDropped)="drop($event, swipeSide.Left)"
              (cdkDropListExited)="placeholders.left = true" (cdkDropListEntered)="placeholders.left = false">
              <div class="list-group-item p-2" [ngClass]="{'activeLayer': layer.active}"
                *ngFor="let layer of getLeftLayers()" cdkDrag>
                <ng-container *ngTemplateOutlet="layerItem;context:{layer: layer}"></ng-container>
              </div>
              <div *ngIf="getLeftLayers()?.length === 0 && placeholders.left">
                <ng-container *ngTemplateOutlet="listPlaceholder"></ng-container>
              </div>
            </td>
            <td cdkDropList #rightList="cdkDropList" [cdkDropListConnectedTo]="[leftList, entireMapList]"
              [cdkDropListData]="getRightLayers()" (cdkDropListDropped)="drop($event, swipeSide.Right)"
              (cdkDropListExited)="placeholders.right = true" (cdkDropListEntered)="placeholders.right = false">
              <div class="list-group-item p-2" [ngClass]="{'activeLayer': layer.active}"
                *ngFor="let layer of getRightLayers()" cdkDrag>
                <ng-container *ngTemplateOutlet="layerItem;context:{layer: layer}"></ng-container>
              </div>
              <div *ngIf="getRightLayers()?.length === 0 && placeholders.right">
                <ng-container *ngTemplateOutlet="listPlaceholder"></ng-container>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>